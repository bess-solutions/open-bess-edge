# BEP-0100: Add IEEE 2030.5 (SEP 2.0) Adapter Interface

| Field | Value |
|---|---|
| **BEP Number** | 0100 |
| **Title** | Add IEEE 2030.5 (SEP 2.0) Adapter Interface |
| **Author** | BESSAI Engineering Team `<ingenieria@bess-solutions.cl>` |
| **Type** | Standards Track |
| **Status** | Draft |
| **Created** | 2026-02-22 |
| **Depends-On** | BESSAI-SPEC-001, BESSAI-SPEC-003 |
| **Replaces** | — |

---

## Abstract

This BEP proposes the addition of an **IEEE 2030.5 (Smart Energy Profile 2.0) adapter interface** as a new module `src/interfaces/sep2_adapter.py`. The adapter enables BESSAI Edge Gateways to present themselves as IEEE 2030.5-compliant DER (Distributed Energy Resource) devices, allowing direct integration with utility DERMS head-end systems, unlocking demand response programs and grid services revenue, and enabling compliance with California CPUC Rule 21 and Australian AEMO AS/NZS 4777.2.

---

## Motivation

### Market Access

BESSAI currently communicates via GCP Pub/Sub (BESSAI-SPEC-003) and MQTT to operator-controlled cloud systems. This architecture does not allow direct bidirectional communication with **utility DERMS** (Distributed Energy Resource Management Systems), which are the primary control plane for grid-connected BESS above certain capacities in regulated markets:

- **California (USA):** CPUC Rule 21 requires IEEE 2030.5 for DER interconnection above a threshold capacity
- **Australia:** AEMO AS/NZS 4777.2 mandates SEP 2.0 for grid-connected DER
- **Hawaii, Colorado, Massachusetts** — similar state-level mandates

Without IEEE 2030.5 support, BESSAI adopters in these markets must deploy a separate third-party gateway (e.g., SolarNetwork, EnerNOC) adding cost and integration complexity.

### Revenue

IEEE 2030.5 compliance enables:
- **Demand Response** (DR) programs: utilities pay to curtail or dispatch BESS
- **Ancillary Services** (frequency regulation, spinning reserve)
- **VPP aggregation** by utilities directly (vs. third-party aggregators)

Typical DR revenue: **USD 15–50 per kW per year** for dispatchable BESS capacity.

---

## Specification

### New Module: `src/interfaces/sep2_adapter.py`

The adapter SHALL implement the following interface, expressed as a Protocol:

```python
class SEP2Adapter(Protocol):
    """IEEE 2030.5 SEP 2.0 adapter for BESSAI Edge Gateway.

    MUST expose a REST server compliant with IEEE 2030.5-2018.
    MUST use TLS 1.2 minimum with mutual client certificates.
    MUST map DERControl commands to write_tag() calls on a DataProvider.
    """

    async def start(self, host: str, port: int, tls_context: ssl.SSLContext) -> None:
        """Start the SEP 2.0 REST server."""
        ...

    async def get_edev(self) -> dict:
        """GET /edev — EndDevice registration resource."""
        ...

    async def get_der_status(self, driver: DataProvider) -> dict:
        """GET /edev/{edevID}/der/{derID}/derStatus — current DER status."""
        ...

    async def get_der_settings(self) -> dict:
        """GET /edev/{edevID}/der/{derID}/derSettings — capability settings."""
        ...

    async def post_der_control(
        self, control: dict, driver: DataProvider
    ) -> None:
        """Incoming DER control from utility DERMS.

        MUST translate IEEE 2030.5 opModConnect / opModEnergize / setMaxW
        to the appropriate write_tag() call on the DataProvider.
        MUST validate that the command does not violate SafetyGuard limits.
        MUST respond 201 Created on success or 4xx on validation failure.
        """
        ...

    async def mirror_usage_point(self, telemetry: dict) -> None:
        """POST /mup — MirrorUsagePoint: push interval metering data to DERMS."""
        ...
```

### DERStatus Mapping (BESSAI-SPEC-003 → IEEE 2030.5)

| IEEE 2030.5 Field | BESSAI Tag | Notes |
|---|---|---|
| `readingType.commodity` | — | `4` (Electricity) hardcoded |
| `DERStatus.operationalModeStatus.value` | `operating_mode` | Enum mapping required |
| `DERStatus.stateOfChargeStatus.value` | `soc_pct` | Scale ×100 to fixed-point per spec |
| `DERStatus.storageModeStatus.value` | Derived from `active_power_kw` | Charge/Discharge/Idle |
| `DERReadingType.maxWh` | `battery_capacity_kwh` (config) | Read from device profile |
| `DERReadingType.maxW` | `max_power_kw` (config) | Read from device profile |

### DERControl Mapping (IEEE 2030.5 → BESSAI write_tag)

| IEEE 2030.5 Control | BESSAI write_tag | Guard |
|---|---|---|
| `opModConnect: false` | `write_tag("operating_mode", "standby")` | SafetyGuard pre-check |
| `setMaxW: N` | `write_tag("P_setpoint_kW", N/1000)` | Must not exceed SafetyGuard max |
| `opModEnergize: true` | `write_tag("operating_mode", "charge")` | SOC < 98% check |

### Transport Requirements

- **TLS 1.2 minimum** (MUST) — mutual client certificates  
- **HTTP/1.1** initially acceptable; HTTP/2 SHOULD be supported  
- **Content-Type:** `application/sep+xml` for XML resources  
- **Content-Type:** `application/sep-json+json` for JSON alt  

> This BEP initially specifies JSON representation (non-normative XML equivalent). Full XML conformance is deferred to BEP-0101.

---

## Backwards Compatibility

The `sep2_adapter.py` module is **additive only**. It does not modify:
- `src/drivers/base.py` (`DataProvider` protocol)
- `src/core/main.py` orchestrator loop  
- `BESSAI-SPEC-001`, `BESSAI-SPEC-002`, `BESSAI-SPEC-003`

Existing deployments without IEEE 2030.5 are unaffected. The adapter is opt-in, activated via a new config variable:

```env
SEP2_ENABLED=true
SEP2_PORT=8443
SEP2_TLS_CERT=/certs/server.crt
SEP2_TLS_KEY=/certs/server.key
SEP2_TLS_CA=/certs/ca.crt
```

---

## Implementation Plan

| Task | Effort | Owner |
|---|---|---|
| Core `SEP2Adapter` class with aiohttp server | 3 days | Engineering |
| mTLS configuration and cert validation | 1 day | Engineering |
| DERStatus / DERSettings resource handlers | 1 day | Engineering |
| DERControl command handler + SafetyGuard integration | 2 days | Engineering |
| MirrorUsagePoint periodic posting | 1 day | Engineering |
| Unit tests (≥ 15 tests, mock DERMS) | 2 days | Engineering |
| Documentation + BESSAI-SPEC-001 delta | 1 day | Engineering |
| **Estimated Total** | **~11 engineering days** | |

---

## Test Plan

- Unit tests via `pytest-asyncio` with mock DERMS client
- Integration test: BESSAI ↔ OpenADR 3.0 reference server
- SunSpec Alliance conformance test suite (target: after merge)

---

## Reference Implementation

See gap analysis in [`docs/compliance/ieee_2030_5_compliance.md`](../../docs/compliance/ieee_2030_5_compliance.md)

---

## Open Issues

1. **XML vs JSON:** The IEEE 2030.5 normative format is XML. This BEP initially specifies JSON representation for development speed. A follow-up BEP-0101 should add full XML conformance.  
2. **Certificate management:** How should BESSAI manage per-site client certificates for the DERMS? Potentially a future BEP (BESSAI-managed PKI vs. operator-provided certs).  
3. **Scope:** Should SEP 2.0 support be in the edge gateway or in a separate BESSAI cloud service? The TSC should decide before implementation begins.
